var includeDom = document.getElementById("includejs");
var v = includeDom.src.substring(includeDom.src.indexOf("?v=")+3);
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/css/icons.css?v='+v+'" />');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/css/main.css?v='+v+'"  />');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/css/appframework.css?v='+v+'"  />');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/css/lists.css?v='+v+'"  />');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/css/forms.css?v='+v+'"  />');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/css/buttons.css?v='+v+'"  />');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/css/badges.css?v='+v+'"  />');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/css/grid.css?v='+v+'"  />');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/plugins/css/af.actionsheet.css?v='+v+'"  />');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/plugins/css/af.popup.css?v='+v+'"  />');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/plugins/css/af.scroller.css?v='+v+'"  />');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/plugins/css/af.selectBox.css?v='+v+'"  /> ');
//document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/plugins/css/af.subpanel.css?v='+v+'"  /> ');
//document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/plugins/css/af.pathmenu.css?v='+v+'"  /> ');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/plugins/mobiscroll-master/css/mobiscroll.scroller.css?v='+v+'"  /> ');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/plugins/mobiscroll-master/css/mobiscroll.scroller.android-holo.css?v='+v+'"  /> ');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/plugins/mobiscroll-master/css/mobiscroll.animation.css?v='+v+'"  /> ');

document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/css/android.css?v='+v+'"  />');
document.write('<link rel="stylesheet" type="text/css" href="./skin/app/jqmobi-2.1.0/css/android/page.css?v='+v+'"  />');

document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/appframework.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.actionsheet.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.css3animate.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.passwordBox.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.scroller.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.selectBox.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.touchEvents.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.touchLayer.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.popup.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/ui/appframework.ui.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/ui/transitions/fade.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/ui/transitions/flip.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/ui/transitions/pop.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/ui/transitions/slide.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/ui/transitions/slideRight.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/ui/transitions/slideDown.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/ui/transitions/slideUp.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.slidemenu.js?v='+v+'"></script>');
//document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.subpanel.js?v='+v+'"></script>');
//document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.pathmenu.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.carousel.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/mobiscroll-master/js/mobiscroll.appframework.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/mobiscroll-master/js/mobiscroll.core.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/mobiscroll-master/js/mobiscroll.scroller.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/mobiscroll-master/js/mobiscroll.datetime.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/mobiscroll-master/js/mobiscroll.scroller.android-holo.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/mobiscroll-master/js/i18n/mobiscroll.i18n.zh.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.num.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/swipeout.js?v='+v+'"></script>');
document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/hammer.js?v='+v+'"></script>');

if (!((window.DocumentTouch && document instanceof DocumentTouch) || 'ontouchstart' in window)) {
    document.write('<script type="text/javascript" charset="utf-8" src="./skin/app/jqmobi-2.1.0/plugins/af.desktopBrowsers.js?v='+v+'"></script>');
}
//设置变量
//app服务器地址
//var appServerAddr="http://dzbstest.wintax.cn";
var appServerAddr="http://dzbstest.gdltax.gov.cn";
if(window.location.href.indexOf("file://")==-1&&window.location.href.indexOf("://")!=-1){
	appServerAddr = window.location.href.substring(window.location.href.indexOf("://")+3);
	appServerAddr = appServerAddr.substring(0,appServerAddr.indexOf("/appserver"));
	appServerAddr = window.location.href.substring(0,window.location.href.indexOf("://")+3)+appServerAddr;
}
var wxJsSdkConfig = false;

///////////公共方法
//当前页面运行在什么浏览器中
function thisWebType(){
	var ua = navigator.userAgent.toLowerCase();
	var localhostUrl=window.location.href;
	if(ua.indexOf('cloudpay')>=0){
		return "YSF";
	}
	if(typeof(window.app)!="undefined"){
		return "APP";
	}else if(ua.match(/MicroMessenger/i)=="micromessenger") {
        return "WX";
    }else if(localhostUrl.indexOf("wbsdt")!= -1) {
        return "WBSDT";
    }else{
    	return "TP";
    }
}

var FsHtml5 = {
	counter : 0,
	service : {},
	params : {},
	result : {},
	success : {},
	fail : {},
	callNative : function(service, params, success, fail) {
		var key = "key" + (this.counter++);
		this.service[key] = service;
		if (typeof params != 'undefined') {
			this.params[key] = JSON.stringify(params);
		}
		if (typeof success != 'undefined') {
			this.success[key] = success;
		}
		if (typeof fail != 'undefined') {
			this.fail[key] = fail;
		}
		var iframe = document.createElement("IFRAME");
		iframe.setAttribute("src", "foresee://callNative?key=" + key);
		document.documentElement.appendChild(iframe);
		iframe.parentNode.removeChild(iframe);
		iframe = null;
		return this.result[key];
	},
	getService : function(key) {
		return this.service[key];
	},
	getParams : function(key) {
		return this.params[key];
	},
	callback : function(resultText, key) {
		this.result[key] = resultText;
		var resultObj = eval("(" + resultText + ")");
		if (resultObj.code == 0) {
			if (typeof this.success[key] != "undefined") {
				setTimeout("FsHtml5.success['" + key + "']('" + resultObj.data + "')", 0);
			}
		} else {
			if (typeof this.fail[key] != "undefined") {
				setTimeout("FsHtml5.fail['" + key + "']('" + resultObj.data + "')", 0);
			}
		}
	}
};

var Base64 = {  
	    // 转码表  
	    table : [  
	            'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',  
	            'I', 'J', 'K', 'L', 'M', 'N', 'O' ,'P',  
	            'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',  
	            'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',  
	            'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',  
	            'o', 'p', 'q', 'r', 's', 't', 'u', 'v',  
	            'w', 'x', 'y', 'z', '0', '1', '2', '3',  
	            '4', '5', '6', '7', '8', '9', '+', '/' 
	    ],  
	    UTF16ToUTF8 : function(str) {  
	        var res = [], len = str.length;  
	        for (var i = 0; i < len; i++) {  
	            var code = str.charCodeAt(i);  
	            if (code > 0x0000 && code <= 0x007F) {  
	                // 单字节，这里并不考虑0x0000，因为它是空字节  
	                // U+00000000 – U+0000007F  0xxxxxxx  
	                res.push(str.charAt(i));  
	            } else if (code >= 0x0080 && code <= 0x07FF) {  
	                // 双字节  
	                // U+00000080 – U+000007FF  110xxxxx 10xxxxxx  
	                // 110xxxxx  
	                var byte1 = 0xC0 | ((code >> 6) & 0x1F);  
	                // 10xxxxxx  
	                var byte2 = 0x80 | (code & 0x3F);  
	                res.push(  
	                    String.fromCharCode(byte1),   
	                    String.fromCharCode(byte2)  
	                );  
	            } else if (code >= 0x0800 && code <= 0xFFFF) {  
	                // 三字节  
	                // U+00000800 – U+0000FFFF  1110xxxx 10xxxxxx 10xxxxxx  
	                // 1110xxxx  
	                var byte1 = 0xE0 | ((code >> 12) & 0x0F);  
	                // 10xxxxxx  
	                var byte2 = 0x80 | ((code >> 6) & 0x3F);  
	                // 10xxxxxx  
	                var byte3 = 0x80 | (code & 0x3F);  
	                res.push(  
	                    String.fromCharCode(byte1),   
	                    String.fromCharCode(byte2),   
	                    String.fromCharCode(byte3)  
	                );  
	            } else if (code >= 0x00010000 && code <= 0x001FFFFF) {  
	                // 四字节  
	                // U+00010000 – U+001FFFFF  11110xxx 10xxxxxx 10xxxxxx 10xxxxxx  
	            } else if (code >= 0x00200000 && code <= 0x03FFFFFF) {  
	                // 五字节  
	                // U+00200000 – U+03FFFFFF  111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx  
	            } else /** if (code >= 0x04000000 && code <= 0x7FFFFFFF)*/ {  
	                // 六字节  
	                // U+04000000 – U+7FFFFFFF  1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx  
	            }  
	        }  
	 
	        return res.join('');  
	    },  
	    UTF8ToUTF16 : function(str) {  
	        var res = [], len = str.length;  
	        var i = 0;  
	        for (var i = 0; i < len; i++) {  
	            var code = str.charCodeAt(i);  
	            // 对第一个字节进行判断  
	            if (((code >> 7) & 0xFF) == 0x0) {  
	                // 单字节  
	                // 0xxxxxxx  
	                res.push(str.charAt(i));  
	            } else if (((code >> 5) & 0xFF) == 0x6) {  
	                // 双字节  
	                // 110xxxxx 10xxxxxx  
	                var code2 = str.charCodeAt(++i);  
	                var byte1 = (code & 0x1F) << 6;  
	                var byte2 = code2 & 0x3F;  
	                var utf16 = byte1 | byte2;  
	                res.push(String.fromCharCode(utf16));  
	            } else if (((code >> 4) & 0xFF) == 0xE) {  
	                // 三字节  
	                // 1110xxxx 10xxxxxx 10xxxxxx  
	                var code2 = str.charCodeAt(++i);  
	                var code3 = str.charCodeAt(++i);  
	                var byte1 = (code << 4) | ((code2 >> 2) & 0x0F);  
	                var byte2 = ((code2 & 0x03) << 6) | (code3 & 0x3F);  
	                utf16 = ((byte1 & 0x00FF) << 8) | byte2  
	                res.push(String.fromCharCode(utf16));  
	            } else if (((code >> 3) & 0xFF) == 0x1E) {  
	                // 四字节  
	                // 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx  
	            } else if (((code >> 2) & 0xFF) == 0x3E) {  
	                // 五字节  
	                // 111110xx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx  
	            } else /** if (((code >> 1) & 0xFF) == 0x7E)*/ {  
	                // 六字节  
	                // 1111110x 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx 10xxxxxx  
	            }  
	        }  
	 
	        return res.join('');  
	    },  
	    encode : function(str) {  
	        if (!str) {  
	            return '';  
	        }  
	        var utf8    = this.UTF16ToUTF8(str); // 转成UTF8  
	        var i = 0; // 遍历索引  
	        var len = utf8.length;  
	        var res = [];  
	        while (i < len) {  
	            var c1 = utf8.charCodeAt(i++) & 0xFF;  
	            res.push(this.table[c1 >> 2]);  
	            // 需要补2个=  
	            if (i == len) {  
	                res.push(this.table[(c1 & 0x3) << 4]);  
	                res.push('==');  
	                break;  
	            }  
	            var c2 = utf8.charCodeAt(i++);  
	            // 需要补1个=  
	            if (i == len) {  
	                res.push(this.table[((c1 & 0x3) << 4) | ((c2 >> 4) & 0x0F)]);  
	                res.push(this.table[(c2 & 0x0F) << 2]);  
	                res.push('=');  
	                break;  
	            }  
	            var c3 = utf8.charCodeAt(i++);  
	            res.push(this.table[((c1 & 0x3) << 4) | ((c2 >> 4) & 0x0F)]);  
	            res.push(this.table[((c2 & 0x0F) << 2) | ((c3 & 0xC0) >> 6)]);  
	            res.push(this.table[c3 & 0x3F]);  
	        }  
	 
	        return res.join('');  
	    },  
	    decode : function(str) {  
	        if (!str) {  
	            return '';  
	        }  
	 
	        var len = str.length;  
	        var i   = 0;  
	        var res = [];  
	 
	        while (i < len) {  
	            code1 = this.table.indexOf(str.charAt(i++));  
	            code2 = this.table.indexOf(str.charAt(i++));  
	            code3 = this.table.indexOf(str.charAt(i++));  
	            code4 = this.table.indexOf(str.charAt(i++));  
	 
	            c1 = (code1 << 2) | (code2 >> 4);  
	            c2 = ((code2 & 0xF) << 4) | (code3 >> 2);  
	            c3 = ((code3 & 0x3) << 6) | code4;  
	 
	            res.push(String.fromCharCode(c1));  
	 
	            if (code3 != 64) {  
	                res.push(String.fromCharCode(c2));  
	            }  
	            if (code4 != 64) {  
	                res.push(String.fromCharCode(c3));  
	            }  
	 
	        }  
	 
	        return this.UTF8ToUTF16(res.join(''));  
	    }  
	}; 

function initIosContext() {
	// 修改IOS下的导航
	$(".header").each(function() {
		$(this).css("color", "inherit");
		$(this).css("border-color", "#33B5E5");
		$(this).css("background-color", "#4fade9");
		$(this).css("height", "64px");
		$(this).css("padding-top", "18px");
		$($(this).find("h1")[0]).css("font-weight", "bold");
	});
	
	// 通用原生接口
	window.app = {};
	app.back = function() {
		FsHtml5.callNative("back");
	};
	app.pickPhoto = function() {
		FsHtml5.callNative("pickPhoto");
	};
	app.setNsrVo = function(nsrsbh, nsrmc) {
		FsHtml5.callNative("setNsrVo", {nsrsbh : nsrsbh, nsrmc : nsrmc});
	};
	app.setZrrVo = function(nsrsbh, nsrmc) {
		FsHtml5.callNative("setZrrVo", {nsrsbh : nsrsbh, nsrmc : nsrmc});
	};
}

//返回到原生页面
function back(){
	var backUrl = null;
	var reg = new RegExp("(^|&)backUrl=([^&]*)(&|$)", "i");
	var r = window.location.search.substr(1).match(reg);
	if (r != null) backUrl = unescape(r[2]);
	if(backUrl != null){
		window.location.href = backUrl;
	}else{
		switch (thisWebType()){
			case "APP":
				try{
					window.app.back();
				}catch(e){
					$.ui.popup("暂不支持该操作！");
				}
				break;
			case "WX":
				if(wxJsSdkConfig){
					wx.closeWindow();
				}
				break;
			case "TP":
				window.location.href=appServerAddr+'/appserver/assets/ssfw/tpIndex.html';
				break;
		}
	}
}


//启用人脸


function startFPV(xm,sfzjhm){

	if(thisWebType()=="WX"){
		
		if(!wxJsSdkConfig){
	        opt.message="微信配置初始化中，请稍后再试！";
	        $.ui.popup(opt);
		}else{

			wx.ready(function () {
	        wx.invoke('requestWxFacePictureVerify', {"request_verify_pre_info":"{\"name\": \""+xm+"\", \"id_card_number\": \""+sfzjhm+"\"}"},function(res){	
	        if(res.err_code == 0){
			var identifer=res.verify_result;
	        	  var accountInfo = {};
	    		  accountInfo.nsrType = "rl";
	    		  accountInfo.zjlx="201";
	    		  accountInfo.zjhm=sfzjhm;
				  accountInfo.identifer=identifer;
	    		  accountInfo.xm =xm;
	    		  accountInfo.yzm ="rl";
	    		  var accountInfoStr = JSON.stringify(accountInfo);
	    		  accountInfoStr = encodeURIComponent(encodeURIComponent(accountInfoStr));
	    		 	var callBack = {};
		        	callBack.waitMsg = "正在验证...";
		        	callBack.timeout = 20000;
		        	callBack.url = appServerAddr+"/appserver/security/binduser/bindWithUserNamePwd.do?accountInfoStr="+accountInfoStr+"&callback=?&time="+new Date().getTime();
		        	callBack.success = function(d){
		        		if(d.flag =='error'){
							opt.message=d.errMsg;
		                     $.ui.popup(opt);
						}else{
	                        $.ui.popup({
	                	        title:"提示",
	                	        message:"绑定成功！",
	                	        cancelOnly: true,
	                	        cancelText: "确定",
	                	        cancelCallback: function(){
		       	                     $.ui.goBack();
		       	                     initBindInfo();
	                	        }
	                	  });
						}
		        	};
		        	callJsonP(callBack);
	        }else{
			   	var ret = res.err_msg;
	        		ret += " err_Code: " + res.err_code;
				
	        	opt.message="认证失败:"+ret;
	        	//ret +=res.resultCode;
	        	$.ui.popup(opt);
	        }
	        /*	if(res.errCode == 0) {
	        	var verify_identifier = res.verify_result;
	        	// 开发者选择是否使用后台文档获取本次认证的其他信息
	        	$.ui.popup("认证成功:"+verify_identifier);
	        	} else {
	        		var ret = res.err_msg;
	        		ret += "errCode: " + res.resultCode;
	        		alert(ret);
	        	}*/
	        	});
			});
		}
	}
}





function startFPVForFwh(xm,sfzjhm){

	if(thisWebType()=="WX"){
		
		if(!wxJsSdkConfig){
	        opt.message="微信配置初始化中，请稍后再试！";
	        $.ui.popup(opt);
		}else{

			wx.ready(function () {
	        wx.invoke('requestWxFacePictureVerify', {"request_verify_pre_info":"{\"name\": \""+xm+"\", \"id_card_number\": \""+sfzjhm+"\"}"},function(res){	
	        if(res.err_code == 0){
			var identifer=res.verify_result;
	        	  var accountInfo = {};
	    		  accountInfo.nsrType = "rl";
	    		  accountInfo.zjlx="201";
	    		  accountInfo.zjhm=sfzjhm;
				  accountInfo.identifer=identifer;
	    		  accountInfo.xm =xm;
	    		  accountInfo.yzm ="rl";
	    		  var accountInfoStr = JSON.stringify(accountInfo);
	    		  accountInfoStr = encodeURIComponent(encodeURIComponent(accountInfoStr));
	    		 	var callBack = {};
		        	callBack.waitMsg = "正在验证...";
		        	callBack.timeout = 20000;
		        	callBack.url = appServerAddr+"/appserver/security/binduser/bindWithUserNamePwd.do?accountInfoStr="+accountInfoStr+"&callback=?&time="+new Date().getTime();
		        	callBack.success = function(d){
		        		if(d.flag =='error'){
							opt.message=d.errMsg;
		                     $.ui.popup(opt);
						}else{
	                        $.ui.popup({
	                	        title:"提示",
	                	        message:"绑定成功！",
	                	        cancelOnly: true,
	                	        cancelText: "确定",
	                	        cancelCallback: function(){ 
	                	        	checkBindUser();
	                	        }
	                	  });
						}
		        	};
		        	callJsonP(callBack);
	        }else{
			   	var ret = res.err_msg;
	        		ret += " err_Code: " + res.err_code;
				
	        	opt.message="认证失败:"+ret;
	        	//ret +=res.resultCode;
	        	$.ui.popup(opt);
	        }
	        /*	if(res.errCode == 0) {
	        	var verify_identifier = res.verify_result;
	        	// 开发者选择是否使用后台文档获取本次认证的其他信息
	        	$.ui.popup("认证成功:"+verify_identifier);
	        	} else {
	        		var ret = res.err_msg;
	        		ret += "errCode: " + res.resultCode;
	        		alert(ret);
	        	}*/
	        	});
			});
		}
	}
}










//启动扫描
var interval;
function startScan(callback,characterSet){
	if(thisWebType()=="WX"){
		if(!wxJsSdkConfig){
	        opt.message="微信配置初始化中，请稍后再试！";
	        $.ui.popup(opt);
		}else{
	    	$.ui.blockUI(0.5);
	        $.ui.showMask('扫描中，请稍候...');
	  		wx.scanQRCode({
	  		    needResult: 1, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
	  		    scanType: ["qrCode","barCode"], // 可以指定扫二维码还是一维码，默认二者都有
	  		    success: function (res) {
	                $.ui.hideMask();
	                $.ui.unblockUI();
	      		    var result = res.resultStr; // 当needResult 为 1 时，扫码返回的结果
	      		    callback.success(result);
	      		},
	      		error : function(){
	                $.ui.hideMask();
	                $.ui.unblockUI();
	                callback.error();
	      		},
	      		cancel : function(){
	                $.ui.hideMask();
	                $.ui.unblockUI();
	                callback.cancel();
	      		}
	  		});
		}
	}else if(thisWebType()=="APP"){
		$.ui.blockUI(0.5);
	    $.ui.showMask('扫描中，请稍候...');
	    try{
	    	if (typeof window.app.scan == 'undefined') {
				FsHtml5.callNative("scan", {}, function(scanedValue) {
					$.ui.hideMask();
					$.ui.unblockUI();
					if (scanedValue == "cancel") {
						callback.cancel();
					} else {
						callback.success(scanedValue);
					}
				});
				return;
			}
	    	if(typeof(characterSet)=="undefined"){
				window.app.scan("utf-8");
	    	}else{
				window.app.scan(characterSet);
	    	}
			interval = window.setInterval(function(){
				var scanedValue = window.app.getNativeValue();
				if(scanedValue != ""){
	                $.ui.hideMask();
	                $.ui.unblockUI();
					window.clearInterval(interval);
					if(scanedValue == "cancel"){
						callback.cancel();
					}else{
						callback.success(scanedValue);
					}
				}
			},500);
		}catch(e){
            $.ui.hideMask();
            $.ui.unblockUI();
			callback.error();
		}
	}else if(thisWebType()=="WBSDT"){
		gdbs.getScanQrCode({
		success:function(qrCode){	
	sxbllsj(qrCode);
	callback.success(qrCode);
		},
		fail:function(errorMsg){
	sxbllsj(errorMsg);
		}
		});
	}else{
		opt.message="暂不支持该浏览器！";
		$.ui.popup(opt);
	}
}

//发送jsonP请求
function callJsonP(callBack){
	callBack.hasCallSuccess = false;
	callBack.hasCallError = false;
	if(callBack.waitMsg){
		$.ui.blockUI(0.5);
	    $.ui.showMask(callBack.waitMsg);
	}
	var timeOut = callBack.timeout||20000;
    $.jsonP({
        url:callBack.url+(callBack.url.indexOf("?")==-1?"?":"&")+"timeOut="+timeOut,
        timeout:timeOut,
        success:function(d){
        	if(callBack.hasCallSuccess){return;}
        	callBack.hasCallSuccess = true;
        	if(callBack.waitMsg){
                $.ui.hideMask();
                $.ui.unblockUI();
        	}
        	callBack.success(d);
        },
        error:function(arg0, arg1, arg2){
        	if(callBack.hasCallError){return;}
        	callBack.hasCallError = true;
        	if(callBack.waitMsg){
                $.ui.hideMask();
                $.ui.unblockUI();
        	}
            if(arg1=="timeout"){
                //opt.message="连接超时！";
                //$.ui.popup(opt);
            }else if(arg1=="error"){
                //opt.message="系统异常！";
                //$.ui.popup(opt);
            }
        }
    });
}

//如果需要用到微信的js-sdk，需要先调用该方法初始化微信js-sdk
function wxConfig(wxReady){

	if (thisWebType() == "WX") {
		var localUrl = encodeURIComponent(window.location.href.split('#')[0]);
		var callBack = {};
		callBack.timout = 10000;
		callBack.url = appServerAddr + "/appserver/wx/getJsSdkConfig.do?url=" + localUrl + "&callback=?&time=" + new Date().getTime();
		callBack.success = function(d) {
			wx.config({
				beta: true,
				debug : false, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
				appId : d.appId, // 必填，公众号的唯一标识
				timestamp : d.timestamp, // 必填，生成签名的时间戳
				nonceStr : d.nonceStr, // 必填，生成签名的随机串
				signature : d.signature,// 必填，签名，见附录1
				jsApiList: ["requestWxFacePictureVerify","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","startRecord","stopRecord","onVoiceRecordEnd","playVoice","pauseVoice","stopVoice","onVoicePlayEnd","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","translateVoice","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
			});
			wx.ready(function() {
				wxJsSdkConfig = true;
				if(typeof(wxReady)=="function"){
					wxReady();
				}
				
			});
		};
		callJsonP(callBack);
	}
}

var opt = {
    title:"提示",
    cancelOnly: true,
    cancelText: "确定",
    message:""
};



function checkIsBindZrr(binded){
	var callBack = {};
	callBack.waitMsg = "正在获取个人绑定信息，请稍候...";
	callBack.url = appServerAddr+"/appserver/security/binduser/getWebAppUserDetails.do?callback=?&time="+new Date().getTime();
	callBack.success = function(d){
		if(d.flag =='error'){//没登录
			//跳转到登录页面
		    $.ui.blockUI(0.5);
	        $.ui.showMask("正在跳转到登录界面，请稍候...");
	        window.setTimeout(function(){
	        	window.location.href="../ssfw/tpIndex.html?qdly=wbsdt&retUrl="+encodeURIComponent(window.location.href);
	        },100);
		}else if(d.userDetails.zrrYh==null){//没绑定自然人
			//跳转到自然人登录页面
		    $.ui.blockUI(0.5);
	        $.ui.showMask("正在跳转到个人验证界面，请稍候...");
	        window.setTimeout(function(){
	        	window.location.href="../zrr/zrrLogin.html?qdly=wbsdt&retUrl="+encodeURIComponent(window.location.href);
	        },100);
		}else{
			if(typeof(binded)=="function"){
				binded(d.userDetails);
			}
			
		}
	};
	callJsonP(callBack);
}

function checkIsBindNsr(binded){
	var callBack = {};
	callBack.waitMsg = "正在获取企业绑定信息，请稍候...";
	callBack.url = appServerAddr+"/appserver/security/binduser/getWebAppUserDetails.do?callback=?&time="+new Date().getTime();
	callBack.success = function(d){
		if(d.flag =='error'){//没登录
			//跳转到登录页面
		    $.ui.blockUI(0.5);
	        $.ui.showMask("正在跳转到登录界面，请稍候...");
	        window.setTimeout(function(){
	        	window.location.href="../ssfw/tpIndex.html?qdly=wbsdt&retUrl="+encodeURIComponent(window.location.href);
	        },100);
		}else if (d.userDetails.nsrYh==null){//没绑定纳税人
			//跳转到企业登录页面
		    $.ui.blockUI(0.5);
	        $.ui.showMask("正在跳转到企业验证界面，请稍候...");
	        window.setTimeout(function(){
	        	window.location.href="../nsr/nsrLogin.html?qdly=wbsdt&retUrl="+encodeURIComponent(window.location.href);
	        },100);
		}else{
			if(typeof(binded)=="function"){
				binded(d.userDetails);
			}
			
		}
	};
	callJsonP(callBack);
}
var lock,action,firstPwd;
function showLock(a,fun){
	action = a;
	if(action == "check" && localStorage.lastCheckPwd!=null && localStorage.lastCheckPwd!='null') {
	
		if(new Date().getTime()-localStorage.lastCheckPwd < 1800*1000){//半小时内无需从新解锁
			if(typeof(fun)=="function"){
				fun();
			}
			return;
		}
	}else if(action == "del" && (localStorage.localPwd == null || localStorage.localPwd == 'null')){
		$("#forget").hide();
		$("#afui").popup({
			title:"提示",
			message:"您尚未设置手势密码，是否现在设置？",
			cancelText:"否",
			doneText:"是",
			doneCallback:function(){
				showLock("set");
			}
		});	
		return;
	}
	if(lock == null){
		// 如果本地没有密码，表示没有设置，则不校验
		if((localStorage.localPwd == null || localStorage.localPwd == 'null') && action != "set") {
			$("#forget").hide();
			if(typeof(fun)=="function"){
				fun();
			}
			return ;
		}
		lock = new H5lock({
		    width:"350",
		    height:"350",
		    setPassword:function(pwd){
		    	var localPwd = localStorage.localPwd;
		    	if(action == "check"){
		    		if(localPwd == null || localPwd == 'null'){

		    			if(firstPwd!=null){
			    			if(firstPwd == pwd){
			    				localStorage.localPwd = pwd;
			    				firstPwd = null;
			    				this.hide();
			    				localStorage.lastCheckPwd = new Date().getTime();
			    				if(typeof(fun)=="function"){
			    					fun();
			    				}
			    			}else{
					    		this.setTitle("两次密码不一致，请重新输入");
					    		this.updateCircleStyle("red");
			    			}
			    		}else{
			    			firstPwd = pwd;
				    		this.updateCircleStyle("#2CFF26");
				    		this.setTitle("请再次输入密码");
				    		$("#forget").show();
			    		}
		    		}else{
						if(localPwd!=pwd){
				    		this.setTitle("密码错误，请重新输入");
				    		this.updateCircleStyle("red");
						}else{
							this.hide();
		    				localStorage.lastCheckPwd = new Date().getTime();
		    				if(typeof(fun)=="function"){
		    					fun();
		    				}
						}
		    		}
		    	}else if (action == "set"){
		    		if(localPwd == null || localPwd == 'null'){
		    			if(firstPwd!=null){
			    			if(firstPwd == pwd){
			    				localStorage.localPwd = pwd;
			    				firstPwd = null;
			    				this.hide();
			    				localStorage.lastCheckPwd = new Date().getTime();
			    				initLockButton();//修改手势密码按钮样式
			    				if(typeof(fun)=="function"){
			    					fun();
			    				}
			    			}else{
					    		this.setTitle("两次密码不一致，请重新输入");
					    		this.updateCircleStyle("red");
			    			}
			    		}else{
			    			firstPwd = pwd;
				    		this.updateCircleStyle("#2CFF26");
				    		this.setTitle("请再次输入密码");
				    		$("#forget").show();
			    		}
		    		}else{
						if(localPwd!=pwd){
				    		this.setTitle("密码错误，请重新输入");
				    		this.updateCircleStyle("red");
						}else{
							this.hide();
		    				localStorage.lastCheckPwd = new Date().getTime();
		    				if(typeof(fun)=="function"){
		    					fun();
		    				}
						}
		    		}
		    	}else if(action == "del"){
	    			if(localPwd!=pwd){
			    		this.setTitle("密码错误，请重新输入");
			    		this.updateCircleStyle("red");
					}else{
						localStorage.localPwd = null;
						localStorage.lastCheckPwd = null;
						this.hide();
						initLockButton();//修改手势密码按钮样式			
					}
		    	}
		    }
		});
		
	}else{
		lock.show();
	}
}

//跳转到关注广东地税的home页
function toGDHomeUrl(){
	var url="http://mp.weixin.qq.com/mp/profile_ext?action=home&__biz=MjM5MzczMDU0Ng==#wechat_webview_type=1&wechat_redirect";
	window.location.href=url;
}

function sendRedirect(tyyzUrl){
       $.ui.blockUI(0.5);
       $.ui.showMask("正在验证统一平台身份，请稍候..."); 
	  window.location.href=Base64.decode(tyyzUrl);
}

//网办事大厅事项办理量收集接口
function sxbllsj(data){

if(window.localStorage){

	var gdbsItemConfigId = window.localStorage.getItem("gdbsItemConfigId");

	var accessNo = window.localStorage.getItem("accessNo");

	var gdbsRandom = window.localStorage.getItem("gdbsRandom");
						
	var contentStr;

	if(null != gdbsItemConfigId && "null" !=gdbsItemConfigId && null != accessNo && "null" !=accessNo && null != gdbsRandom && "null" !=gdbsRandom){


		var content = {};
			content.condition="ok";
			content.result="ok";
			contentStr = JSON.stringify(content);


	gdbs.commitHandleContent({	
		itemConfigId: gdbsItemConfigId,
		accessNo: accessNo, 
		random:	gdbsRandom,
		content: contentStr,
		success: function(data){
		//alert(data);
		},
		fail:function(errorMsg){
		//alert(errorMsg);
		}
	});
		}

}
}